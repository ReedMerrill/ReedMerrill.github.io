---
title: "Estimating State-level Partisanship"
author: "Reed Merrill"
bibliography: "mrp.bib"
format:
    revealjs:
        theme: [default, custom.scss]
---

```{r setup, echo=FALSE, include=FALSE, message=FALSE}
library(tidyverse)
```

## Introduction

::: {.columns}
:::: {.column}
Reed Merrill

PhD Student, Political Science

Fields: American Politics and Methodology

<br>

University of Arizona

School of Government and Public Policy
::::
:::: {.column}
![](images/sgpp-logo.png)
::::
:::

## Motivation and Problem

Many important political processes occur at the state level, but it is not usually straightforward to measure public opinion at this in sub-national units.

- Public opinion data measured at the level of individual states is few and far between.
- Large public opinion surveys, such as the American National Election Study (ANES), are designed to be nationally representative, sometimes at the expense of state level representativeness.
    - Priorities: national representativeness, in-person interviews (over web-based surveys)
    - Consequences: 
        - Smaller sample sizes
        - Area-clustered sampling
            - Not representative of sub-national units

## Project Objectives

Estimate partisanship (percentage of population per party) in each state for the last 35 years.

- Need to specify a model that performs well on the American National Election Studies (ANES) survey data.
    - current model underperforms at predicting Independent partisanship
        - mine the survey data for features that are predictive of this subset of partisans

<!--
::: {.fragment}
ANES Data:

- available for every year of interest
- consistent measures across years (measurement validity)
- sacrifices representativeness
:::
-->

::: {.notes}
- Summarize this slide
    - The last 35 or so years could represent a "contemporary era" for politics
- Have made some progress. I will present my initial results and then show how feature selection, a data mining technique, has improved my model.
- Need to mine features: It is difficult to predict independent partisanship, and existing academic theories are limited in this regard.
:::

## Multilevel Regression and Poststratification

A technique used to improve the representativeness of survey data.

Steps:

1. Multilevel Regression: Train a model that predicts the survey outcome you want improved estimates for. I use Bayesian multilevel multinomial regression.
    1. Use predictors that are available in census data so that accurate estimates of the population proportions can be used later during weighting.
2. Make predictions: Use the model from **Step 1** to make predictions on measurable characteristics from the populations of interest.
3. Poststratify: Weight the predictions according to how frequently individuals with the combinations of your measured characteristics occur in the populations of interest.

## Predictors

Individual-level predictors: Age, Race, Sex, Education

- categorical variables

The above demographic predictors can be supplemented to include sub-national units, like states, and other state-level predictors (@gelmanChapter).

State level predictors: 

- Republican vote share from the most recent election
- Region (Northeast, Midwest, South, West, East, Northwest)
- racial composition (pct. black residents)
- religious composition (pct. Christian)
- urbanity (pct. urban population)

::: {.notes}
- state level predictors improve predictive accuracy and facilitate sub-national estimation
:::

## Poststratification

- Constructed using the 5-year version of the 2012 American Community Survey (ACS) via IPUMS USA.
    - Yearly demographic estimates of the population, based on 5 years of prior data.

<br>

**Example Poststratification Frame**

```{r poststrat ex, include=TRUE}
#| tbl-colwidths: [60,40]
load("/home/reed/Dropbox/01-samara-ra/presentations/mrp-presentation/psframe-ex.RData")
source("/home/reed/Dropbox/01-samara-ra/data-collection/scripts/pid/modeling-functions.r")
knitr::kable(psframe_ex)
```

:::{.notes}
- This is an simplified example of poststratification frame, extracteed from the 2012 frame that I constructed.
- Describe the table.
- Qickly explain the logic behind poststratification.
- Using models based on the previous multilevel regression equation, we can predict party identification at the individual level. 
- We then poststratify these predictions to estimate party identification at the state and national levels.
- Explain n per cell and overall proportions
:::

## The Challenge of Predicting Independent Partisanship

```{r val data, cache=TRUE}
# load model testing results
load("/home/reed/Dropbox/01-samara-ra/data-collection/scripts/pid/ces-08to20/model-testing/analysis-w-prep.RData")
mrp_results <- mrp_results |> drop_na() # the religion data is missing for ND, so needs to be dropped
mrp_results <- mrp_results |>
    left_join(
        all_truth,
        by = c("state", "party")
    )
z95 <- qnorm(0.975)
model_perf_by_party <- mrp_results |>
    group_by(model, party) |>
    summarize(
        corr = cor.test(mean_pid, truth_pid, method = "pearson", conf.level = .95)$estimate,
        corr_conflow = cor.test(mean_pid, truth_pid, method = "pearson", conf.level = .95)$conf.int[1],
        corr_confhigh = cor.test(mean_pid, truth_pid, method = "pearson", conf.level = .95)$conf.int[2],
        mae = mean(abs(mean_pid - truth_pid)),
        sd_ae = sd(abs(mean_pid - truth_pid))
    )
# reorder grouping vars
# model
model_perf_by_party$model <- model_perf_by_party$model |> 
    factor(
        levels = c(
            "baseline",
            "stpreds",
            "stpreds_plus",
            "Christian"
        )
    )
levels(model_perf_by_party$model)  <- c("1", "2", "3", "4")
```
```{r mae plot}
# MAE plot
ggplot(model_perf_by_party, aes(x = model, y = mae, color = party)) +
    geom_point(position = position_dodge(width = 0.75)) +
    geom_errorbar(
        aes(ymin = mae - sd_ae, ymax = mae + sd_ae), 
        width = 0.2, position = position_dodge(width = 0.75)) +
  theme_minimal() +
  xlab("Model") +
  ylab("Estimate") +
  ggtitle("Mean Absolute Error") +
  scale_color_manual(values = c("blue", "red", "yellow")) +
  guides(color = guide_legend(title = "Party")) +
  coord_flip()
```

## ANES Data

```{r anes, cache=TRUE}
raw_data <- read_csv("anes.csv")
```

## References
